<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <style>
        .method {
            padding: 12px;
            background: #331763;
            color: white;
            border-radius: 10px;
            margin: 3px;
        }

        .selected {
            background: #2F6F44;
        }
    </style>
</head>
<body>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <select id="objectTestCasesSelect" class="form-select" aria-label="multiple select example" autofocus>
                </select>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6"><h5>Input:</h5><p id="input"></p></div>
                        <div class="col-md-6"><h5>Output:</h5><p id="output"></p></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button id="selectedTestCase" type="button" class="btn btn-primary">Select Test Case</button>
            </div>
        </div>
    </div>
</div>
<div id="content">



</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
<script id="testCasesButton" type="text/x-handlebars-template">
    <button id="{{id}}" type="button" class="btn btn-primary testCasesButton" data-bs-toggle="modal" data-bs-target="#exampleModal"></button>
</script>
<script id="testCasesOptions" type="text/x-handlebars-template">
    {{#each options}}
    <option>{{this}}</option>
    {{/each}}
</script>
<script id="inputOutputToolTip" type="text/x-handlebars-template">
    <div class="container">
        <div class="row">
            <div class="col">
                Input:
            </div>
            <div class="col">
                Output:
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{input}}
            </div>
            <div class="col">
                {{output}}
            </div>
        </div>
    </div>
</script>
<script>
$(document).ready(function(){

    var objectsTree =[
        {
            "packageName": "package",
            "objectName": "Object1",
            "methodName": "method",
        },
        {
            "packageName": "package",
            "objectName": "Object2",
            "methodName": "method",
            "children" : [{
                "packageName": "package",
                "objectName": "Object3",
                "methodName": "method",
            }]
        }
        ,
        {
            "packageName": "package",
            "objectName": "Object4",
            "methodName": "method",
            "children": [{
                "packageName": "package",
                "objectName": "Object5",
                "methodName": "method",
            },{
                "packageName": "package",
                "objectName": "Object6",
                "methodName": "method",
            }]
        }
        ,
        {
            "packageName": "package",
            "objectName": "Object7",
            "methodName": "method",
            "children": [{
                "packageName": "package",
                "objectName": "Object8",
                "methodName": "method",
            },{
                "packageName": "package",
                "objectName": "Object9",
                "methodName": "method",
            },
            {
                "packageName": "package",
                "objectName": "Object10",
                "methodName": "method",
                "children": [{
                    "packageName": "package",
                    "objectName": "Object11",
                    "methodName": "method",
                },{
                    "packageName": "package",
                    "objectName": "Object12",
                    "methodName": "method",
                }]
            }]
        }
    ];

    $.each(objectsTree, function(i, node) {
        function appendToElement(element, node) {
            let table = $('<table>');
            let tr = $('<tr>');
            let div = $('<div>');
            div.prop('id', node.objectName)
            tr.append($('<td>').append(div.addClass("method").append(node.objectName)))
            table.append(tr);
            element.append(table);
            return tr;
        }

        function appendTo(element, node) {
            let tr = appendToElement(element, node);
            if(node.children != null) {
                let td = $('<td>');
                tr.append(td);
                $.each(node.children, function (i, node) {
                    appendTo(td, node)
                })
            }
        }
        appendTo($('#content'), node);
    });

    let testCases = {
        "Object1":
            {
                "testCase1": {
                    "Object1": {
                        "input": "myInput1",
                        "output": "myOutput1"
                    }
                },
                "testCase2": {
                    "Object1": {
                        "input": "myInput2",
                        "output": "myOutput2"
                    }
                },
            },
        "Object2":
            {
                "testCase1": {
                    "Object2": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Object3": {
                        "input": "myInput",
                        "output": "myOutput"
                    }
                },
            },
        "Object4":
            {
                "testCase1": {
                    "Object4": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Object5": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Object6": {
                        "input": "myInput",
                        "output": "myOutput"
                    }
                }
            },
        "Object7":
            {
                "testCase1": {
                    "Object7": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Object8": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Object9": {
                        "input": "myInput",
                        "output": "myOutput"
                    }
                },
                "testCase2": {
                    "Object7": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Object10": {
                        "input": "myInput",
                        "output": "myOutput"
                    }
                }
            }
        }

    $(".method").each(function(i, method) {
        if(testCases.hasOwnProperty($(this).prop('id'))){
            var testCasesButton = Handlebars.compile( $('#testCasesButton').html() );
            $(this).before($('<div>').html(testCasesButton({ id: method.id })));
        }
    });

    var selectedObject;
    var selectedObjectTestCases;
    let selectedTestCase;
    window.tippyInstances = [];

    $('#exampleModal').on('shown.bs.modal', function() {
        $(this).find('[autofocus]').focus();
    });

    $(".testCasesButton").click(function() {
        let objectId = $(this).prop('id');
        selectedObject = objectId;
        let objectTestCases = testCases[objectId];
        selectedObjectTestCases = objectTestCases;
        let options = Object.keys(objectTestCases);

        displayInputAndOutput(options[0]);
        $("#objectTestCasesSelect").html(Handlebars.compile($('#testCasesOptions').html())({options: options}));
    });

    $("#objectTestCasesSelect").change(function() {
        displayInputAndOutput($(this).val());
    });

    function displayInputAndOutput(option) {
        selectedTestCase = option;
        var selectedObjectTestCaseObject = selectedObjectTestCases[option][selectedObject];
        $("#input").html(selectedObjectTestCaseObject.input);
        $("#output").html(selectedObjectTestCaseObject.output);
    }

    function clearTippies(){
        tippyInstances.forEach(instance => {
            instance.destroy();
        });
        tippyInstances.length = 0;
    }

    $("#selectedTestCase").click(function(){
        $(".selected").removeClass("selected");
        clearTippies();
        $.each(Object.keys(selectedObjectTestCases[selectedTestCase]), function(index, value){
            let selector = "#"+value+".method";
            $(selector).addClass("selected");
            let inputOuput = selectedObjectTestCases[selectedTestCase][value];
            let content = Handlebars.compile($('#inputOutputToolTip').html())({input: inputOuput.input, output: inputOuput.output});
            let instances = tippy(selector, {
                placement: 'bottom',
                content: content,
                trigger: 'click',
                interactive: true,
                hideOnClick: 'toggle',
                allowHTML: true
            });
            window.tippyInstances = tippyInstances.concat(instances);
        });
        $("#exampleModal").modal('hide');
    });

    $(document).keypress(function(e) {
        if ($("#exampleModal").hasClass('show') && (e.keycode == 13 || e.which == 13)) {
            $("#selectedTestCase").click();
        }
    });
});


</script>
</body>
</html>