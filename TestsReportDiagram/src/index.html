<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <style>
        .method {
            padding: 12px;
            background: #331763;
            color: white;
            border-radius: 10px;
            margin: 3px;
        }

        .selected {
            background: #2F6F44;
        }
        .openTestCasesSelectModalButton{
            border-radius: 10px;
        }
        .methodTd{
            vertical-align:top;
        }
    </style>
</head>
<body>

<div class="modal fade" id="testCaseSelectModal" tabindex="-1" aria-labelledby="testCaseSelectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="testCaseSelectModalLabel">Select test case</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <select id="testCasesSelect" class="form-select" aria-label="multiple select example" autofocus>
                </select>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6"><h5>Input:</h5><p id="input"></p></div>
                        <div class="col-md-6"><h5>Output:</h5><p id="output"></p></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button id="selectTestCase" type="button" class="btn btn-primary">Select Test Case</button>
            </div>
        </div>
    </div>
</div>

<div id="content">

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
<script id="openTestCasesSelectModalButton" type="text/x-handlebars-template">
    <button id="{{id}}" type="button" class="btn btn-primary openTestCasesSelectModalButton" data-bs-toggle="modal" data-bs-target="#testCaseSelectModal">Test Cases</button>
</script>
<script id="testCasesOptions" type="text/x-handlebars-template">
    {{#each options}}
    <option>{{this}}</option>
    {{/each}}
</script>
<script id="inputOutputToolTip" type="text/x-handlebars-template">
    <div class="container">
        <div class="row">
            <div class="col">
                Input:
            </div>
            <div class="col">
                Output:
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{input}}
            </div>
            <div class="col">
                {{output}}
            </div>
        </div>
    </div>
</script>
<script>
$(document).ready(function(){

    var methodsTree =[
        {
            "methodName": "Method1",
        },
        {
            "methodName": "Method2",
            "children" : [{
                "methodName": "Method3",
            }]
        }
        ,
        {
            "methodName": "Method4",
            "children": [{
                "methodName": "Method5",
            },{
                "methodName": "Method6",
            }]
        }
        ,
        {
            "methodName": "Method7",
            "children": [{
                "methodName": "Method8",
            },{
                "methodName": "Method9",
            },
            {
                "methodName": "Method10",
                "children": [{
                    "methodName": "Method11",
                },{
                    "methodName": "Method12",
                }]
            }]
        }
    ];

    $.each(methodsTree, function(i, node) {
        function appendToElement(element, node) {
            let table = $('<table>');
            let tr = $('<tr>');
            let div = $('<div>');
            div.prop('id', node.methodName)
            let td = $('<td>');
            td.addClass("methodTd");
            tr.append(td.append(div.addClass("method").append(node.methodName)))
            table.append(tr);
            element.append(table);
            return tr;
        }

        function appendTo(element, node) {
            let tr = appendToElement(element, node);
            if(node.children != null) {
                let td = $('<td>');
                tr.append(td);
                $.each(node.children, function (i, node) {
                    appendTo(td, node)
                })
            }
        }
        appendTo($('#content'), node);
    });

    let testCasesToMethod = {
        "Method1":
            {
                "testCase1": {
                    "Method1": {
                        "input": "myInput1",
                        "output": "myOutput1"
                    }
                },
                "testCase2": {
                    "Method1": {
                        "input": "myInput2",
                        "output": "myOutput2"
                    }
                },
            },
        "Method2":
            {
                "testCase1": {
                    "Method2": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Method3": {
                        "input": "myInput",
                        "output": "myOutput"
                    }
                },
            },
        "Method4":
            {
                "testCase1": {
                    "Method4": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Method5": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Method6": {
                        "input": "myInput",
                        "output": "myOutput"
                    }
                }
            },
        "Method7":
            {
                "testCase1": {
                    "Method7": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Method8": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Method9": {
                        "input": "myInput",
                        "output": "myOutput"
                    }
                },
                "testCase2": {
                    "Method7": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Method10": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Method11": {
                        "input": "myInput",
                        "output": "myOutput"
                    },
                    "Method12": {
                        "input": "myInput",
                        "output": "myOutput"
                    }
                }
            }
        }

    $(".method").each(function(i, method) {
        if(testCasesToMethod.hasOwnProperty($(this).prop('id'))){
            var openTestCasesSelectModalButton = Handlebars.compile( $('#openTestCasesSelectModalButton').html() );
            $(this).prepend($('<div>').html(openTestCasesSelectModalButton({ id: method.id })));
        }
    });

    var selectedMethodId;
    var selectedMethodTestCases;
    let selectedMethodTestCaseId;
    window.tippyInstances = [];

    $('#testCaseSelectModal').on('shown.bs.modal', function() {
        $(this).find('[autofocus]').focus();
    });

    $(".openTestCasesSelectModalButton").click(function() {
        let methodId = $(this).prop('id');
        selectedMethodId = methodId;
        let methodTestCases = testCasesToMethod[methodId];
        selectedMethodTestCases = methodTestCases;
        let options = Object.keys(methodTestCases);

        displayInputAndOutput(options[0]);
        $("#testCasesSelect").html(Handlebars.compile($('#testCasesOptions').html())({options: options}));
    });

    $("#testCasesSelect").change(function() {
        displayInputAndOutput($(this).val());
    });

    function displayInputAndOutput(option) {
        selectedMethodTestCaseId = option;
        var methodExecution = selectedMethodTestCases[selectedMethodTestCaseId][selectedMethodId];
        $("#input").html(methodExecution.input);
        $("#output").html(methodExecution.output);
    }

    function clearTippies(){
        tippyInstances.forEach(instance => {
            instance.destroy();
        });
        tippyInstances.length = 0;
    }

    $("#selectTestCase").click(function(){
        $(".selected").removeClass("selected");
        clearTippies();
        $.each(Object.keys(selectedMethodTestCases[selectedMethodTestCaseId]), function(index, methodExecution){
            let selector = "#"+methodExecution+".method";
            $(selector).addClass("selected");
            let inputOutput = selectedMethodTestCases[selectedMethodTestCaseId][methodExecution];
            let content = Handlebars.compile($('#inputOutputToolTip').html())({input: inputOutput.input, output: inputOutput.output});
            let instances = tippy(selector, {
                placement: 'bottom',
                content: content,
                trigger: 'click',
                interactive: true,
                hideOnClick: 'toggle',
                allowHTML: true
            });
            window.tippyInstances = tippyInstances.concat(instances);
        });
        $("#testCaseSelectModal").modal('hide');
    });

    $(document).keypress(function(e) {
        if ($("#testCaseSelectModal").hasClass('show') && (e.keycode == 13 || e.which == 13)) {
            $("#selectTestCase").click();
        }
    });
});


</script>
</body>
</html>